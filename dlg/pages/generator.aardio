import win.ui;
import fsys;
import fsys.dlg;
import fsys.dlg.dir;
import win.clip;
/*DSG{{*/
var winform = win.form(text="Generator";right=679;bottom=399;bgcolor=16777215)
winform.add(
copyBtn={cls="button";text="Â§çÂà∂";left=560;top=368;right=680;bottom=400;db=1;dr=1;font=LOGFONT(h=-16);z=8};
downBtn={cls="button";text='\u2228';left=152;top=368;right=200;bottom=400;db=1;dl=1;font=LOGFONT(h=-19);z=6};
fileBtn={cls="button";text="Êñá‰ª∂";left=624;top=40;right=672;bottom=64;z=11};
folderBtn={cls="button";text="Êñá‰ª∂Â§π";left=624;top=72;right=672;bottom=96;z=12};
reduceBtn={cls="button";text="-";left=0;top=368;right=48;bottom=400;db=1;dl=1;font=LOGFONT(h=-19);z=4};
resultEdt={cls="edit";left=208;top=232;right=680;bottom=360;bgcolor=16777215;db=1;dl=1;dr=1;dt=0.58;edge=1;font=LOGFONT(h=-16);multiline=1;readonly=1;z=7};
scopeEdt={cls="edit";left=208;top=40;right=616;bottom=96;db=0.76;dl=1;dr=1;dt=1;edge=1;font=LOGFONT(h=-16);multiline=1;z=9};
subjectEdt={cls="edit";left=208;top=104;right=680;bottom=224;db=0.44;dl=1;dr=1;dt=0.26;edge=1;font=LOGFONT(h=-16);multiline=1;z=2};
tipTxt={cls="richedit";text="<EMOJI> <TYPE>(<SCOPE>): <SUBJECT>";left=208;top=8;right=680;bottom=40;align="center";bgcolor=16777215;dl=1;dr=1;dt=1;font=LOGFONT(h=-16);readonly=1;z=10};
typeLst={cls="listbox";left=0;top=40;right=200;bottom=360;db=1;dl=1;dt=1;edge=1;font=LOGFONT(h=-16;name='Segoe UI Emoji');integralHeight=0;items={};z=3};
typeSelectionComb={cls="combobox";left=0;top=0;right=200;bottom=24;dl=1;dt=1;edge=1;font=LOGFONT(h=-16;name='Segoe UI Emoji');items={};mode="dropdownlist";z=1};
upBtn={cls="button";text='\u2227';left=96;top=368;right=144;bottom=400;db=1;dl=1;font=LOGFONT(h=-19);z=5}
)
/*}}*/

// È¢úËâ≤Â∏∏Èáè Blue Green Red
var C_RED = 0x0000FF; // Á∫¢Ëâ≤
var C_GREEN = 0x00FF00; // ÁªøËâ≤
var C_GRAY = 0x808080; // ÁÅ∞Ëâ≤

/*
// For debug
if (_STUDIO_INVOKED) {
	import io;
	io.open();
}
*/

// Áî±‰∫éÁºñËæëÂô®ÂéüÂõ†Ôºå‰∏ãÊñπÁöÑÂ≠óÁ¨¶‰∏≤‰∏çÊñπ‰æøÁºñËæëÔºåÊúÄÂ•Ω‰ΩøÁî®Â§ñÁΩÆÁºñËæëÂô®
var emojis = {{"üíæ";"Feat"};{"üîß";"Fix"};{"üìÑ";"Docs"};{"üéá";"Style"};{"üß©";"Refactor"};{"‚úîÔ∏è";"Test"};{"‚ùå";"Test"};{"üìù";"Chore"};{"üì¶";"Struct"};{"üêõ";"Bug"}};
var selectType = {}; // ÈÄâÊã©ÂàóË°®

// ÂàùÂßãÂåñ‰∏ãÊãâÊ°Ü
for (i, each in emojis) {
	winform.typeSelectionComb.add(each[1] + " - " + each[2]); // aardio ‰∏≠ÔºåÊï∞ÁªÑÁ¥¢Âºï‰ªé 1 ÂºÄÂßã
}

/// Êõ¥Êñ∞ÂàóË°®
updateList = function(){
	winform.typeLst.clear();
	for (i, each in selectType){
		winform.typeLst.add(
			emojis[each][1] + " - " + emojis[each][2]
		);
	}
}

/// ÂàóË°®ÈÄâÊã©
winform.typeSelectionComb.onListChange = function(id, event){
	if (winform.typeSelectionComb.selIndex != 0) {
		setC1(C_GREEN);
		table.push(selectType, winform.typeSelectionComb.selIndex);
		selectType = table.unique(selectType);
		updateList();
		generateText();
	}
}

/// "-" ÊåâÈíÆË¢´ÁÇπÂáª
winform.reduceBtn.oncommand = function(id, event){
	var index = winform.typeLst.selIndex;
	if (index != 0) {
		table.remove(selectType, index);
		updateList();
		if (index > #selectType) {
			winform.typeLst.selIndex = index - 1;
		} else {
			winform.typeLst.selIndex = index; // Ë∑üË∏™ÁÑ¶ÁÇπ
		}
		generateText();
		if (#selectType == 0) setC1(C_RED);
	}
}

/// "‚àß" ÊåâÈíÆË¢´ÁÇπÂáª
winform.upBtn.oncommand = function(id, event){
	var index = winform.typeLst.selIndex;
	if (index > 1) {
		var t = selectType[index-1];
		selectType[index-1] = selectType[index];
		selectType[index] = t;
		updateList();
		winform.typeLst.selIndex = index - 1; // Ë∑üË∏™ÁÑ¶ÁÇπ
		generateText();
	}
}

/// "‚à®" ÊåâÈíÆË¢´ÁÇπÂáª
winform.downBtn.oncommand = function(id,event){
	var index = winform.typeLst.selIndex;
	if (index != 0 && index != #selectType) {
		var t = selectType[index+1];
		selectType[index+1] = selectType[index];
		selectType[index] = t;
		updateList();
		winform.typeLst.selIndex = index + 1; // Ë∑üË∏™ÁÑ¶ÁÇπ
		generateText();
	}
}

/// "Â§çÂà∂" ÊåâÈíÆË¢´ÁÇπÂáª
winform.copyBtn.oncommand = function(id, event){
	win.clip.write(winform.resultEdt.text);
}

/// ÊñáÊú¨Êõ¥Êîπ
winform.subjectEdt.onChange = Œª () generateText();
winform.scopeEdt.onChange = Œª () generateText();

/// ÁîüÊàêÊñáÂ≠ó
generateText = function () {
	var text = "";
	var typeText = "";
	for (i, each in selectType){
		text = text + emojis[each][1] + " ";
		typeText = typeText + emojis[each][2] + ", ";
	}
	io.print(winform.scopeEdt.text, winform.subjectEdt.text, text, typeText);
	text = text ++ string.trimright(typeText, ", ");
	if (winform.scopeEdt.text == "") setC2(C_GRAY) else {
		setC2(C_GREEN);
		text = text + "(" + tostring(winform.scopeEdt.text) + "): ";
	}
	if (winform.subjectEdt.text == "") setC3(C_RED) else {
		setC3(C_GREEN);
		text = text ++ tostring(winform.subjectEdt.text);
	}
	winform.resultEdt.text = text;
}

/// <EMOJI> <TYPE>(<SCOPE>): <SUBJECT>
setC1 = Œª (color) setColor(1, 14, color);

setC2 = Œª (color) setColor(15, 23, color);

setC3 = Œª (color) setColor(26, 34, color);

setColor = function (startSel, endSel, color) {
	winform.tipTxt.setsel(startSel, endSel);
	winform.tipTxt.setSelCharformat(textColor=color);
	winform.tipTxt.deselect();
}

winform.fileBtn.oncommand = function(id,event){
	var files = fsys.dlg.openEx(, "ÈÄâÊã©‰∏Ä‰∏™ÊàñÂ§ö‰∏™Êñá‰ª∂", "/", winform);
	for (i, each in files) {
		winform.scopeEdt.text = winform.scopeEdt.text + fsys.getFileName(each) + ", ";
	}
	winform.scopeEdt.onChange();
}

winform.folderBtn.oncommand = function(id,event){
	var files = fsys.dlg.dir("/", winform, "ÈÄâÊã©‰∏Ä‰∏™Êñá‰ª∂Â§π", , , true);
	for (i, each in files) {
		winform.scopeEdt.text = winform.scopeEdt.text + fsys.getFileName(each) + ", ";
	}
	winform.scopeEdt.onChange();
}

winform.show();

setC1(C_RED);
setC2(C_GRAY);
setC3(C_RED);

win.loopMessage();
return winform;